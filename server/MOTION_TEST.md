# Motion Test Page

A standalone test page to verify motion generation pipeline outputs.

## What it does

The `/motion-test` endpoint provides a drag-and-drop interface to test motion JSON files generated by `sample/generate.py`. It loads a VRM character model and plays back the motion data in real-time.

## How to use

### 1. Start the server

Make sure your FastAPI server is running:

```bash
uvicorn server.app:app --reload --port 8000
```

### 2. Generate a motion file

Use the motion generation script to create a test motion:

```bash
python sample/generate.py \
  --model_path ./save/model000200000.pt \
  --text_prompt "a person walking forward" \
  --motion_length 4.0 \
  --num_samples 1 \
  --vrm_motion_path ./test_motion.json
```

This will create a JSON file with motion data.

### 3. Open the test page

Navigate to: `http://localhost:8000/motion-test`

### 4. Upload and test

1. Drag and drop your generated `.json` file onto the dropzone, or click to browse
2. The file will be uploaded and the motion data will be displayed
3. Click **Play** to see the character perform the motion
4. Use **Pause** and **Reset** to control playback

## Features

- **Drag & Drop Upload**: Easy file upload interface
- **Motion Info Display**: Shows FPS, frame count, duration, and joint count
- **Playback Controls**: Play, pause, and reset the animation
- **3D Viewer**: Interactive Three.js scene with orbit controls
- **Real-time Rendering**: Smooth VRM character animation

## API Endpoints

### POST `/api/upload-motion`
Upload a motion JSON file for testing.

**Request**: `multipart/form-data` with a file field
**Response**: 
```json
{
  "motion_url": "/motions/test-uploads/abc123_motion.json",
  "filename": "motion.json"
}
```

### GET `/motion-test`
Serves the motion test HTML page.

### GET `/modelA.vrm`
Serves the VRM model file.

## Motion JSON Format

The expected format is generated by `utils/export_vrm_json.py`:

```json
{
  "version": 1,
  "fps": 20,
  "joints": ["pelvis", "left_hip", "right_hip", ...],
  "frames": [
    {
      "root_position": [x, y, z],
      "rotations": [[w, x, y, z], ...],
      "positions": [[x, y, z], ...]
    },
    ...
  ]
}
```

## Troubleshooting

**VRM model not loading**: 
- Ensure `three-vrm/public/modelA.vrm` exists
- Check browser console for errors

**Motion not playing**:
- Verify the JSON file has valid structure
- Check that `fps`, `joints`, and `frames` fields are present
- Look for errors in the browser console

**Upload fails**:
- Make sure the file is a valid JSON file
- Check that the server has write permissions to `three-vrm/public/motions/test-uploads/`

## Tech Stack

- **Frontend**: Vanilla JavaScript with Three.js and @pixiv/three-vrm
- **Backend**: FastAPI with static file serving
- **3D Rendering**: Three.js with WebGL
- **Character Format**: VRM (Virtual Reality Model)
